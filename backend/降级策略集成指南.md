# ğŸ›¡ï¸ é™çº§ç­–ç•¥é›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å°†6çº§é™çº§å¤„ç†ç­–ç•¥é›†æˆåˆ°æ™ºèƒ½åˆ‡ç‰‡Visionåˆ†æç³»ç»Ÿä¸­ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹éƒ½èƒ½æä¾›å¯ç”¨çš„åˆ†æç»“æœã€‚

## ğŸ¯ é™çº§ç­–ç•¥æ ¸å¿ƒç‰¹æ€§

### 6çº§é™çº§æœºåˆ¶
```
Level 0: æ™ºèƒ½åˆ‡ç‰‡åˆ†æ (æœ€ä¼˜) â†’ 5åˆ†é’Ÿè¶…æ—¶
Level 1: ä¼˜åŒ–é‡è¯•åˆ‡ç‰‡åˆ†æ â†’ 3åˆ†é’Ÿè¶…æ—¶ï¼Œ3æ¬¡é‡è¯•
Level 2: ç›´æ¥Visionåˆ†æ â†’ 1åˆ†é’Ÿè¶…æ—¶
Level 3: PaddleOCRæ–‡å­—è¯†åˆ« â†’ 30ç§’è¶…æ—¶
Level 4: åŸºç¡€å›¾åƒä¿¡æ¯ â†’ å³æ—¶è¿”å›
Level 5: é”™è¯¯æŠ¥å‘Š (æœ€ç»ˆå…œåº•) â†’ æ°¸ä¸å¤±è´¥
```

### æ™ºèƒ½é™çº§å†³ç­–
- **è´¨é‡éªŒè¯**ï¼šæ¯çº§éƒ½æœ‰ç»“æœè´¨é‡æ£€æŸ¥
- **è¶…æ—¶æ§åˆ¶**ï¼šé˜²æ­¢æ— é™ç­‰å¾…
- **é‡è¯•æœºåˆ¶**ï¼šæŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
- **èµ„æºä¿æŠ¤**ï¼šé¿å…èµ„æºè€—å°½

## ğŸ”§ å¿«é€Ÿé›†æˆ

### 1. å¯¼å…¥é™çº§ç­–ç•¥
```python
from app.services.fallback_strategy import fallback_strategy, FallbackLevel
from app.services.openai_vision_slicer import OpenAIVisionSlicer
```

### 2. ä½¿ç”¨å¸¦é™çº§çš„åˆ†æ
```python
# åˆå§‹åŒ–åˆ†æå™¨
vision_slicer = OpenAIVisionSlicer()

# æ‰§è¡Œå¸¦é™çº§ç­–ç•¥çš„åˆ†æ
result = await vision_slicer.analyze_image_with_slicing(
    image_path="large_drawing.png",
    task_id="task_001",
    analysis_prompt="åˆ†æå»ºç­‘ç»“æ„å›¾çº¸"
)

# æ£€æŸ¥é™çº§çº§åˆ«å’Œç»“æœ
fallback_info = result['fallback_info']
print(f"åˆ†æçº§åˆ«: {fallback_info['level']}")
print(f"æ˜¯å¦æˆåŠŸ: {fallback_info['success']}")
print(f"å¤„ç†æ—¶é—´: {fallback_info['processing_time']:.2f}s")
```

### 3. å¤„ç†ä¸åŒé™çº§çº§åˆ«çš„ç»“æœ
```python
def handle_analysis_result(result):
    """æ ¹æ®é™çº§çº§åˆ«å¤„ç†åˆ†æç»“æœ"""
    
    level = result['fallback_info']['level']
    success = result['fallback_info']['success']
    data = result['data']
    
    if not success:
        # Level 5: å®Œå…¨å¤±è´¥
        return {
            'status': 'failed',
            'message': 'åˆ†æå¤±è´¥ï¼Œè¯·æ£€æŸ¥å›¾åƒæ–‡ä»¶æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ',
            'recommendations': data.get('recommendations', [])
        }
    
    if level == 'normal':
        # Level 0: æœ€é«˜è´¨é‡ç»“æœ
        return {
            'status': 'excellent',
            'message': 'âœ… å®Œç¾ï¼ä½¿ç”¨äº†æœ€é«˜ç²¾åº¦çš„æ™ºèƒ½åˆ‡ç‰‡åˆ†æ',
            'quality': 'high',
            'components': data.get('processing_summary', {}).get('total_components', 0),
            'confidence': data.get('processing_summary', {}).get('avg_confidence', 0)
        }
    
    elif level == 'retry_slicing':
        # Level 1: ä¼˜åŒ–é‡è¯•æˆåŠŸ
        return {
            'status': 'good',
            'message': 'âœ… åˆ†æå®Œæˆï¼ç»è¿‡ä¼˜åŒ–é‡è¯•è·å¾—å¯é ç»“æœ',
            'quality': 'medium-high',
            'components': data.get('processing_summary', {}).get('total_components', 0),
            'note': 'ä½¿ç”¨äº†ä¼˜åŒ–å‚æ•°ï¼Œç»“æœå¯é '
        }
    
    elif level == 'direct_analysis':
        # Level 2: ç›´æ¥åˆ†æ
        return {
            'status': 'acceptable',
            'message': 'âš ï¸ åˆ†æå®Œæˆï¼ç”±äºå›¾åƒè¾ƒå¤§ï¼Œä½¿ç”¨äº†å‹ç¼©åˆ†æ',
            'quality': 'medium',
            'components': len(data.get('analysis_result', {}).get('components', [])),
            'warning': 'å¤§å›¾åƒå¯èƒ½æœ‰ç²¾åº¦æŸå¤±'
        }
    
    elif level == 'simple_ocr':
        # Level 3: OCRé™çº§
        return {
            'status': 'limited',
            'message': 'âš ï¸ æä¾›æ–‡å­—è¯†åˆ«ç»“æœï¼ŒAIåˆ†ææš‚æ—¶ä¸å¯ç”¨',
            'quality': 'low',
            'texts': len(data.get('texts', [])),
            'components': len(data.get('components', [])),
            'note': 'ä»…æä¾›åŸºç¡€æ–‡å­—è¯†åˆ«å’Œå…³é”®è¯åŒ¹é…'
        }
    
    elif level == 'basic_info':
        # Level 4: åŸºç¡€ä¿¡æ¯
        return {
            'status': 'minimal',
            'message': 'â„¹ï¸ ä»…æä¾›å›¾åƒåŸºç¡€ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§',
            'quality': 'info_only',
            'image_info': data.get('image_properties', {}),
            'recommendations': data.get('fallback_info', {}).get('recommendations', [])
        }
    
    else:
        return {
            'status': 'unknown',
            'message': 'æœªçŸ¥çš„åˆ†æçŠ¶æ€',
            'data': data
        }
```

## ğŸš€ APIç«¯ç‚¹é›†æˆ

### æ›´æ–°ç°æœ‰APIç«¯ç‚¹
```python
# backend/app/api/v1/endpoints/vision_slice.py

@router.post("/analyze-with-slicing")
async def analyze_with_slicing_and_fallback(
    file: UploadFile = File(...),
    analysis_type: str = Query("structural", description="åˆ†æç±»å‹"),
    current_user: User = Depends(get_current_active_user)
):
    """æ™ºèƒ½åˆ‡ç‰‡åˆ†æï¼ˆå¸¦é™çº§ç­–ç•¥ï¼‰"""
    
    task_id = f"vision_slice_{uuid4().hex[:8]}"
    
    try:
        # ä¿å­˜ä¸Šä¼ æ–‡ä»¶
        temp_path = await save_upload_file(file)
        
        # æ‰§è¡Œå¸¦é™çº§ç­–ç•¥çš„åˆ†æ
        vision_slicer = OpenAIVisionSlicer()
        result = await vision_slicer.analyze_image_with_slicing(
            image_path=temp_path,
            task_id=task_id,
            analysis_prompt=get_analysis_prompt(analysis_type)
        )
        
        # å¤„ç†ç»“æœ
        processed_result = handle_analysis_result(result)
        
        # è¿”å›ç»Ÿä¸€æ ¼å¼
        return {
            "success": result['fallback_info']['success'],
            "task_id": task_id,
            "fallback_info": result['fallback_info'],
            "result": processed_result,
            "timestamp": datetime.now().isoformat()
        }
        
    except Exception as e:
        logger.error(f"åˆ†æå¤±è´¥: {e}")
        return {
            "success": False,
            "task_id": task_id,
            "error": str(e),
            "fallback_info": {
                "level": "error",
                "success": False,
                "error_message": "ç³»ç»Ÿå¼‚å¸¸"
            }
        }
    finally:
        # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        if 'temp_path' in locals():
            cleanup_temp_file(temp_path)
```

### æ–°å¢é™çº§çŠ¶æ€æŸ¥è¯¢ç«¯ç‚¹
```python
@router.get("/fallback-stats")
async def get_fallback_statistics(
    days: int = Query(7, description="ç»Ÿè®¡å¤©æ•°"),
    current_user: User = Depends(get_current_active_user)
):
    """è·å–é™çº§ç­–ç•¥ç»Ÿè®¡ä¿¡æ¯"""
    
    # ä»æ•°æ®åº“æˆ–ç¼“å­˜è·å–ç»Ÿè®¡æ•°æ®
    stats = await get_fallback_statistics_from_db(days)
    
    return {
        "period_days": days,
        "total_requests": stats['total'],
        "fallback_distribution": {
            "level_0_normal": stats['level_0'],
            "level_1_retry": stats['level_1'], 
            "level_2_direct": stats['level_2'],
            "level_3_ocr": stats['level_3'],
            "level_4_basic": stats['level_4'],
            "level_5_failed": stats['level_5']
        },
        "success_rate": (stats['total'] - stats['level_5']) / stats['total'] if stats['total'] > 0 else 0,
        "avg_processing_time": stats['avg_time'],
        "recommendations": generate_optimization_recommendations(stats)
    }

@router.get("/fallback-health")
async def check_fallback_health():
    """æ£€æŸ¥é™çº§ç­–ç•¥å¥åº·çŠ¶æ€"""
    
    health_status = {
        "openai_api": await check_openai_api_status(),
        "paddle_ocr": await check_paddle_ocr_status(),
        "sealos_storage": await check_sealos_storage_status(),
        "system_resources": await check_system_resources()
    }
    
    overall_health = all(health_status.values())
    
    return {
        "healthy": overall_health,
        "components": health_status,
        "timestamp": datetime.now().isoformat(),
        "recommendations": get_health_recommendations(health_status)
    }
```

## ğŸ¨ å‰ç«¯é›†æˆ

### Reactç»„ä»¶ç¤ºä¾‹
```typescript
// frontend/src/components/VisionAnalysisWithFallback.tsx

import React, { useState } from 'react';
import { Upload, Button, Alert, Progress, Card, Tag } from 'antd';
import { CloudUploadOutlined, CheckCircleOutlined, WarningOutlined, InfoCircleOutlined } from '@ant-design/icons';

interface FallbackInfo {
  level: string;
  success: boolean;
  processing_time: number;
  fallback_reason: string;
}

interface AnalysisResult {
  success: boolean;
  task_id: string;
  fallback_info: FallbackInfo;
  result: any;
}

const VisionAnalysisWithFallback: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState<AnalysisResult | null>(null);
  
  const handleUpload = async (file: File) => {
    setLoading(true);
    
    try {
      const formData = new FormData();
      formData.append('file', file);
      
      const response = await fetch('/api/v1/vision/analyze-with-slicing', {
        method: 'POST',
        body: formData,
        headers: {
          'Authorization': `Bearer ${getToken()}`
        }
      });
      
      const data = await response.json();
      setResult(data);
      
    } catch (error) {
      console.error('åˆ†æå¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };
  
  const getFallbackLevelInfo = (level: string) => {
    const levelInfo = {
      'normal': { 
        color: 'success', 
        icon: <CheckCircleOutlined />, 
        text: 'æœ€é«˜ç²¾åº¦åˆ†æ',
        description: 'ä½¿ç”¨äº†å®Œæ•´çš„æ™ºèƒ½åˆ‡ç‰‡æŠ€æœ¯'
      },
      'retry_slicing': { 
        color: 'processing', 
        icon: <CheckCircleOutlined />, 
        text: 'ä¼˜åŒ–é‡è¯•æˆåŠŸ',
        description: 'ç»è¿‡å‚æ•°ä¼˜åŒ–è·å¾—å¯é ç»“æœ'
      },
      'direct_analysis': { 
        color: 'warning', 
        icon: <WarningOutlined />, 
        text: 'ç›´æ¥åˆ†æ',
        description: 'å›¾åƒè¾ƒå¤§ï¼Œä½¿ç”¨äº†å‹ç¼©åˆ†æ'
      },
      'simple_ocr': { 
        color: 'warning', 
        icon: <InfoCircleOutlined />, 
        text: 'OCRè¯†åˆ«',
        description: 'ä»…æä¾›æ–‡å­—è¯†åˆ«ç»“æœ'
      },
      'basic_info': { 
        color: 'default', 
        icon: <InfoCircleOutlined />, 
        text: 'åŸºç¡€ä¿¡æ¯',
        description: 'ä»…æä¾›å›¾åƒåŸºç¡€ä¿¡æ¯'
      },
      'error_report': { 
        color: 'error', 
        icon: <WarningOutlined />, 
        text: 'åˆ†æå¤±è´¥',
        description: 'æ‰€æœ‰åˆ†ææ–¹æ³•éƒ½å¤±è´¥äº†'
      }
    };
    
    return levelInfo[level] || levelInfo['error_report'];
  };
  
  return (
    <div className="vision-analysis-container">
      <Card title="æ™ºèƒ½Visionåˆ†æï¼ˆå¸¦é™çº§ä¿æŠ¤ï¼‰">
        <Upload.Dragger
          accept="image/*"
          beforeUpload={(file) => {
            handleUpload(file);
            return false;
          }}
          disabled={loading}
        >
          <p className="ant-upload-drag-icon">
            <CloudUploadOutlined />
          </p>
          <p className="ant-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤åŒºåŸŸä¸Šä¼ </p>
          <p className="ant-upload-hint">æ”¯æŒå¤§å°ºå¯¸å»ºç­‘å›¾çº¸ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³åˆ†ææ–¹æ³•</p>
        </Upload.Dragger>
        
        {loading && (
          <div style={{ marginTop: 16 }}>
            <Progress percent={0} status="active" />
            <p>æ­£åœ¨åˆ†æä¸­ï¼Œå¦‚é‡é—®é¢˜ä¼šè‡ªåŠ¨é™çº§...</p>
          </div>
        )}
        
        {result && (
          <div style={{ marginTop: 16 }}>
            <Alert
              type={result.success ? 'success' : 'error'}
              message={
                <div>
                  <Tag 
                    color={getFallbackLevelInfo(result.fallback_info.level).color}
                    icon={getFallbackLevelInfo(result.fallback_info.level).icon}
                  >
                    {getFallbackLevelInfo(result.fallback_info.level).text}
                  </Tag>
                  <span>{getFallbackLevelInfo(result.fallback_info.level).description}</span>
                </div>
              }
              description={
                <div>
                  <p>å¤„ç†æ—¶é—´: {result.fallback_info.processing_time.toFixed(2)}ç§’</p>
                  {result.fallback_info.fallback_reason && (
                    <p>é™çº§åŸå› : {result.fallback_info.fallback_reason}</p>
                  )}
                </div>
              }
            />
            
            {/* æ ¹æ®ä¸åŒçº§åˆ«æ˜¾ç¤ºä¸åŒçš„ç»“æœå†…å®¹ */}
            {result.success && (
              <Card style={{ marginTop: 16 }} size="small" title="åˆ†æç»“æœ">
                <AnalysisResultDisplay 
                  level={result.fallback_info.level}
                  data={result.result}
                />
              </Card>
            )}
          </div>
        )}
      </Card>
    </div>
  );
};

export default VisionAnalysisWithFallback;
```

## ğŸ“Š ç›‘æ§å’Œå‘Šè­¦

### 1. æ€§èƒ½ç›‘æ§æŒ‡æ ‡
```python
# æ·»åŠ åˆ°ç›‘æ§ç³»ç»Ÿ
FALLBACK_METRICS = {
    'fallback_level_distribution': Counter('vision_fallback_level_total', 'Fallback level distribution', ['level']),
    'fallback_processing_time': Histogram('vision_fallback_duration_seconds', 'Processing time by fallback level', ['level']),
    'fallback_success_rate': Gauge('vision_fallback_success_rate', 'Success rate by fallback level', ['level']),
    'api_error_rate': Counter('vision_api_errors_total', 'API error count', ['error_type'])
}

# åœ¨é™çº§ç­–ç•¥ä¸­æ·»åŠ æŒ‡æ ‡è®°å½•
def record_fallback_metrics(level: FallbackLevel, success: bool, processing_time: float, error_type: str = None):
    FALLBACK_METRICS['fallback_level_distribution'].labels(level=level.value).inc()
    FALLBACK_METRICS['fallback_processing_time'].labels(level=level.value).observe(processing_time)
    
    if error_type:
        FALLBACK_METRICS['api_error_rate'].labels(error_type=error_type).inc()
```

### 2. å‘Šè­¦è§„åˆ™
```yaml
# prometheus_alerts.yml
groups:
  - name: vision_fallback_alerts
    rules:
      - alert: HighFallbackRate
        expr: rate(vision_fallback_level_total{level!="normal"}[5m]) > 0.3
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Visionåˆ†æé™çº§ç‡è¿‡é«˜"
          description: "è¿‡å»5åˆ†é’Ÿå†…é™çº§ç‡è¶…è¿‡30%ï¼Œéœ€è¦æ£€æŸ¥ç³»ç»ŸçŠ¶æ€"
      
      - alert: VisionAPIDown
        expr: rate(vision_fallback_level_total{level="error_report"}[1m]) > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Visionåˆ†æå®Œå…¨å¤±è´¥"
          description: "å‡ºç°Level 5é™çº§ï¼Œéœ€è¦ç«‹å³æ£€æŸ¥"
```

## ğŸ”§ é…ç½®ä¼˜åŒ–

### 1. ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env
# é™çº§ç­–ç•¥é…ç½®
VISION_FALLBACK_LEVEL_0_TIMEOUT=300
VISION_FALLBACK_LEVEL_1_TIMEOUT=180
VISION_FALLBACK_LEVEL_2_TIMEOUT=60
VISION_FALLBACK_LEVEL_3_TIMEOUT=30
VISION_FALLBACK_MAX_RETRIES=3
VISION_FALLBACK_RETRY_DELAYS=2,5,10

# è´¨é‡é˜ˆå€¼
VISION_FALLBACK_MIN_SUCCESS_RATE=0.8
VISION_FALLBACK_MIN_COMPONENTS=1
VISION_FALLBACK_RETRY_MIN_SUCCESS_RATE=0.5
```

### 2. åŠ¨æ€é…ç½®è°ƒæ•´
```python
# æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´è¶…æ—¶
def calculate_dynamic_timeout(base_timeout: int, system_load: float) -> int:
    """æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´è¶…æ—¶"""
    if system_load > 0.8:
        return int(base_timeout * 1.5)  # é«˜è´Ÿè½½æ—¶å»¶é•¿è¶…æ—¶
    elif system_load < 0.3:
        return int(base_timeout * 0.8)  # ä½è´Ÿè½½æ—¶ç¼©çŸ­è¶…æ—¶
    return base_timeout

# æ ¹æ®APIçŠ¶æ€è°ƒæ•´é‡è¯•ç­–ç•¥
def adjust_retry_strategy(api_status: dict) -> dict:
    """æ ¹æ®APIçŠ¶æ€è°ƒæ•´é‡è¯•ç­–ç•¥"""
    if api_status.get('rate_limit_remaining', 100) < 10:
        return {'max_retries': 1, 'delays': [10]}  # APIé…é¢ä¸è¶³æ—¶å‡å°‘é‡è¯•
    elif api_status.get('response_time', 0) > 5:
        return {'max_retries': 2, 'delays': [5, 15]}  # APIå“åº”æ…¢æ—¶å»¶é•¿é—´éš”
    return {'max_retries': 3, 'delays': [2, 5, 10]}  # é»˜è®¤ç­–ç•¥
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é”™è¯¯åˆ†ç±»å’Œå¤„ç†
```python
def classify_error(error: Exception) -> str:
    """é”™è¯¯åˆ†ç±»ï¼Œç”¨äºæ™ºèƒ½é™çº§å†³ç­–"""
    
    error_str = str(error).lower()
    
    if 'rate limit' in error_str or 'quota' in error_str:
        return 'rate_limit'
    elif 'timeout' in error_str or 'connection' in error_str:
        return 'network'
    elif 'permission' in error_str or 'unauthorized' in error_str:
        return 'auth'
    elif 'image' in error_str or 'format' in error_str:
        return 'image_format'
    elif 'memory' in error_str or 'resource' in error_str:
        return 'resource'
    else:
        return 'unknown'

def should_skip_levels(error_type: str) -> List[FallbackLevel]:
    """æ ¹æ®é”™è¯¯ç±»å‹å†³å®šè·³è¿‡å“ªäº›çº§åˆ«"""
    
    skip_map = {
        'auth': [FallbackLevel.LEVEL_0, FallbackLevel.LEVEL_1, FallbackLevel.LEVEL_2],  # æƒé™é”™è¯¯è·³åˆ°OCR
        'image_format': [FallbackLevel.LEVEL_0, FallbackLevel.LEVEL_1, FallbackLevel.LEVEL_2, FallbackLevel.LEVEL_3],  # æ ¼å¼é”™è¯¯è·³åˆ°åŸºç¡€ä¿¡æ¯
        'resource': [FallbackLevel.LEVEL_0, FallbackLevel.LEVEL_1],  # èµ„æºä¸è¶³è·³è¿‡åˆ‡ç‰‡
    }
    
    return skip_map.get(error_type, [])
```

### 2. ç¼“å­˜ç­–ç•¥
```python
from functools import lru_cache
import hashlib

def get_image_hash(image_path: str) -> str:
    """è®¡ç®—å›¾åƒå“ˆå¸Œå€¼"""
    with open(image_path, 'rb') as f:
        return hashlib.md5(f.read()).hexdigest()

@lru_cache(maxsize=100)
def get_cached_analysis_result(image_hash: str, analysis_type: str) -> dict:
    """è·å–ç¼“å­˜çš„åˆ†æç»“æœ"""
    # ä»Redisæˆ–æ•°æ®åº“è·å–ç¼“å­˜ç»“æœ
    pass

def cache_analysis_result(image_hash: str, analysis_type: str, result: dict, ttl: int = 3600):
    """ç¼“å­˜åˆ†æç»“æœ"""
    # ä¿å­˜åˆ°Redisæˆ–æ•°æ®åº“
    pass
```

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
```python
def get_user_friendly_progress_message(level: FallbackLevel, attempt: int = 1) -> str:
    """è·å–ç”¨æˆ·å‹å¥½çš„è¿›åº¦æ¶ˆæ¯"""
    
    messages = {
        FallbackLevel.LEVEL_0: f"æ­£åœ¨ä½¿ç”¨æ™ºèƒ½åˆ‡ç‰‡æŠ€æœ¯åˆ†æå›¾çº¸...",
        FallbackLevel.LEVEL_1: f"ä¼˜åŒ–å‚æ•°é‡è¯•ä¸­ï¼ˆç¬¬{attempt}æ¬¡ï¼‰...",
        FallbackLevel.LEVEL_2: f"åˆ‡æ¢åˆ°ç›´æ¥åˆ†ææ¨¡å¼...",
        FallbackLevel.LEVEL_3: f"ä½¿ç”¨OCRè¯†åˆ«æ–‡å­—ä¿¡æ¯...",
        FallbackLevel.LEVEL_4: f"æå–åŸºç¡€å›¾åƒä¿¡æ¯...",
    }
    
    return messages.get(level, "æ­£åœ¨å¤„ç†ä¸­...")

def estimate_remaining_time(level: FallbackLevel, elapsed_time: float) -> float:
    """ä¼°ç®—å‰©ä½™å¤„ç†æ—¶é—´"""
    
    typical_times = {
        FallbackLevel.LEVEL_0: 45,
        FallbackLevel.LEVEL_1: 30,
        FallbackLevel.LEVEL_2: 8,
        FallbackLevel.LEVEL_3: 12,
        FallbackLevel.LEVEL_4: 1,
    }
    
    expected_time = typical_times.get(level, 10)
    return max(0, expected_time - elapsed_time)
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é›†æˆé—®é¢˜æ’æŸ¥
1. **é™çº§è¿‡äºé¢‘ç¹**ï¼šæ£€æŸ¥OpenAI APIé…é¢å’Œç½‘ç»œçŠ¶å†µ
2. **Level 5 é”™è¯¯**ï¼šæ£€æŸ¥å›¾åƒæ–‡ä»¶å®Œæ•´æ€§å’Œç³»ç»Ÿèµ„æº
3. **æ€§èƒ½é—®é¢˜**ï¼šè°ƒæ•´è¶…æ—¶å‚æ•°å’Œé‡è¯•ç­–ç•¥
4. **ç¼“å­˜é—®é¢˜**ï¼šæ¸…ç†Redisç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶

### è”ç³»æ–¹å¼
- ğŸ“§ æŠ€æœ¯æ”¯æŒ: fallback-support@smart-qto.com
- ğŸ“± ç´§æ€¥çƒ­çº¿: 400-123-4567
- ğŸ”§ åœ¨çº¿æ–‡æ¡£: https://docs.smart-qto.com/fallback
- ğŸ’¬ å¼€å‘è€…ç¤¾åŒº: https://community.smart-qto.com

---

*é™çº§ç­–ç•¥è®©ç³»ç»Ÿæ°¸è¿œå¯ç”¨ï¼Œè®©ç”¨æˆ·æ°¸è¿œæ»¡æ„ï¼* ğŸ›¡ï¸ 