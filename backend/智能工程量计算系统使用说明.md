# æ™ºèƒ½å·¥ç¨‹é‡è®¡ç®—ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

æ™ºèƒ½å·¥ç¨‹é‡è®¡ç®—ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºäººå·¥æ™ºèƒ½æŠ€æœ¯çš„å»ºç­‘å·¥ç¨‹é‡è‡ªåŠ¨è®¡ç®—å¹³å°ï¼Œèƒ½å¤Ÿæ™ºèƒ½è¯†åˆ«å»ºç­‘å›¾çº¸å¹¶æŒ‰ç…§å›½å®¶æ ‡å‡†è‡ªåŠ¨è®¡ç®—å·¥ç¨‹é‡ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ” **æ™ºèƒ½OCRè¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«å»ºç­‘å›¾çº¸ä¸­çš„æ–‡å­—å’Œç¬¦å·
- ğŸ“ **å›¾é›†è§„èŒƒè¯†åˆ«** - ç¬¦åˆå›½æ ‡GB/T 50105-2010å»ºç­‘ç»“æ„åˆ¶å›¾æ ‡å‡†
- ğŸ§® **å·¥ç¨‹é‡è®¡ç®—** - éµå¾ªGB 50500-2013å»ºè®¾å·¥ç¨‹å·¥ç¨‹é‡æ¸…å•è®¡ä»·è§„èŒƒ
- ğŸ’° **é€ ä»·ä¼°ç®—** - åŸºäºå¸‚åœºä»·æ ¼çš„æˆæœ¬åˆ†æ
- ğŸ“Š **æ™ºèƒ½æŠ¥å‘Š** - ç”Ÿæˆè¯¦ç»†çš„è¯†åˆ«å’Œè®¡ç®—æŠ¥å‘Š

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**: FastAPI + Python 3.8+
- **AIå¼•æ“**: YOLOv8x + PaddleOCR
- **å›¾åƒå¤„ç†**: OpenCV + NumPy
- **æ•°æ®å­˜å‚¨**: JSON + SQLite
- **å‰ç«¯ç•Œé¢**: React + TypeScript

### æ ¸å¿ƒæ¨¡å—

#### 1. é«˜çº§OCRå¼•æ“ (`advanced_ocr_engine.py`)
```python
from app.services.advanced_ocr_engine import AdvancedOCREngine

# åˆå§‹åŒ–OCRå¼•æ“
ocr_engine = AdvancedOCREngine()

# æå–æ–‡å­—å’Œç¬¦å·
results = ocr_engine.extract_text_and_symbols("å›¾çº¸è·¯å¾„.jpg")
```

**åŠŸèƒ½ç‰¹ç‚¹:**
- æ”¯æŒå»ºç­‘å›¾çº¸ä¸“ç”¨æ–‡å­—è¯†åˆ«
- æ™ºèƒ½æå–æ„ä»¶ä»£ç ï¼ˆKZã€KLã€LBç­‰ï¼‰
- è‡ªåŠ¨è¯†åˆ«å°ºå¯¸æ ‡æ³¨å’Œææ–™ä¿¡æ¯
- æä¾›æ¼”ç¤ºæ¨¡å¼ï¼Œæ— éœ€å®‰è£…PaddleOCRå³å¯æµ‹è¯•

#### 2. å›¾é›†è§„èŒƒè¯†åˆ«å¼•æ“ (`atlas_recognition_engine.py`)
```python
from app.services.atlas_recognition_engine import AtlasRecognitionEngine

# åˆå§‹åŒ–å›¾é›†è¯†åˆ«å¼•æ“
atlas_engine = AtlasRecognitionEngine()

# è¯†åˆ«å›¾é›†ç¬¦å·
results = atlas_engine.recognize_atlas_symbols("å›¾çº¸è·¯å¾„.jpg", ocr_results)
```

**æ”¯æŒçš„æ„ä»¶ç¬¦å·:**
- **æŸ±ç±»**: KZ(æ¡†æ¶æŸ±)ã€GZ(æ„é€ æŸ±)ã€LZ(æ¢å¼æŸ±)ã€XZ(èŠ¯æŸ±)
- **æ¢ç±»**: KL(æ¡†æ¶æ¢)ã€LL(è¿æ¢)ã€JL(åŸºç¡€æ¢)ã€WKL(å±‹é¢æ¡†æ¶æ¢)
- **æ¿ç±»**: LB(æ¥¼æ¿)ã€WB(å±‹é¢æ¿)ã€YB(é›¨ç¯·æ¿)
- **å¢™ç±»**: Q(å¢™)ã€JQ(å‰ªåŠ›å¢™)ã€FQ(åˆ†éš”å¢™)
- **åŸºç¡€ç±»**: DJJ(ç‹¬ç«‹åŸºç¡€)ã€TJJ(æ¡å½¢åŸºç¡€)ã€FJJ(ç­å½¢åŸºç¡€)

#### 3. å·¥ç¨‹é‡è®¡ç®—å¼•æ“ (`quantity_calculation_engine.py`)
```python
from app.services.quantity_calculation_engine import QuantityCalculationEngine

# åˆå§‹åŒ–è®¡ç®—å¼•æ“
calc_engine = QuantityCalculationEngine()

# è®¡ç®—å·¥ç¨‹é‡
summary = calc_engine.generate_quantity_summary(component_data)
```

**è®¡ç®—è§„åˆ™ (GB 50500-2013):**
- `010101001` - ç°æµ‡æ··å‡åœŸæŸ± (mÂ³)
- `010101002` - ç°æµ‡æ··å‡åœŸæ¢ (mÂ³)
- `010101003` - ç°æµ‡æ··å‡åœŸæ¿ (mÂ³)
- `010102001` - ç°æµ‡æ··å‡åœŸæŸ±æ¨¡æ¿ (mÂ²)
- `010102002` - ç°æµ‡æ··å‡åœŸæ¢æ¨¡æ¿ (mÂ²)
- `010102003` - ç°æµ‡æ··å‡åœŸæ¿æ¨¡æ¿ (mÂ²)
- `010401001` - é’¢ç­‹ (kg)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å…‹éš†é¡¹ç›®
git clone <é¡¹ç›®åœ°å€>
cd smart-qto-system

# å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt

# å¯é€‰ï¼šå®‰è£…PaddleOCRï¼ˆç”¨äºçœŸå®OCRè¯†åˆ«ï¼‰
pip install paddlepaddle paddleocr
```

### 2. è¿è¡Œæµ‹è¯•
```bash
# æµ‹è¯•æ™ºèƒ½å·¥ç¨‹é‡è®¡ç®—ç³»ç»Ÿ
python test_intelligent_quantity_system.py

# æµ‹è¯•å•ä¸ªæ¨¡å—
python app/services/advanced_ocr_engine.py
python app/services/atlas_recognition_engine.py
python app/services/quantity_calculation_engine.py
```

### 3. å¯åŠ¨WebæœåŠ¡
```bash
# å¯åŠ¨åç«¯APIæœåŠ¡
python -m app.main

# è®¿é—®APIæ–‡æ¡£
# http://localhost:8000/docs
```

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### å®Œæ•´å¤„ç†æµç¨‹
```python
from test_intelligent_quantity_system import IntelligentQuantitySystem

# 1. åˆå§‹åŒ–ç³»ç»Ÿ
system = IntelligentQuantitySystem()

# 2. å¤„ç†å»ºç­‘å›¾çº¸
results = system.process_architectural_drawing("å›¾çº¸è·¯å¾„.jpg")

# 3. å¯¼å‡ºç»“æœ
system.export_results(results, "output/é¡¹ç›®åç§°")
```

### å¤„ç†æ­¥éª¤è¯¦è§£

#### æ­¥éª¤1: OCRæ–‡å­—è¯†åˆ«
- è‡ªåŠ¨è¯†åˆ«å›¾çº¸ä¸­çš„æ–‡å­—å†…å®¹
- æå–æ„ä»¶ä»£ç å’Œç¼–å·
- è¯†åˆ«å°ºå¯¸æ ‡æ³¨å’Œææ–™ä¿¡æ¯
- ç”Ÿæˆç»“æ„åŒ–çš„æ–‡æœ¬æ•°æ®

#### æ­¥éª¤2: å›¾é›†è§„èŒƒè¯†åˆ«
- æ ¹æ®å›½æ ‡å›¾é›†åŒ¹é…æ„ä»¶ç¬¦å·
- è¯†åˆ«å›¾çº¸æ¯”ä¾‹å’ŒåŸºæœ¬ä¿¡æ¯
- æå–å°ºå¯¸æ ‡æ³¨å’ŒæŠ€æœ¯å‚æ•°
- éªŒè¯ç»˜å›¾è§„èŒƒç¬¦åˆæ€§

#### æ­¥éª¤3: æ„å»ºæ„ä»¶æ•°æ®
- å°†è¯†åˆ«ç»“æœè½¬æ¢ä¸ºæ ‡å‡†æ„ä»¶æ•°æ®
- åŒ¹é…å…¸å‹å°ºå¯¸å’Œææ–™ç­‰çº§
- å»ºç«‹æ„ä»¶ä¹‹é—´çš„å…³è”å…³ç³»
- éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œåˆç†æ€§

#### æ­¥éª¤4: å·¥ç¨‹é‡è®¡ç®—
- æŒ‰ç…§GB 50500-2013è§„èŒƒè®¡ç®—
- è‡ªåŠ¨å¤„ç†æ‰£å‡è§„åˆ™ï¼ˆæ¢æŸ±èŠ‚ç‚¹ã€æ´å£ç­‰ï¼‰
- ç”Ÿæˆåˆ†é¡¹å·¥ç¨‹é‡æ¸…å•
- è®¡ç®—é’¢ç­‹ç”¨é‡å’Œæ¨¡æ¿é¢ç§¯

#### æ­¥éª¤5: ç”Ÿæˆç»¼åˆæŠ¥å‘Š
- æ±‡æ€»è¯†åˆ«å’Œè®¡ç®—ç»“æœ
- è¯„ä¼°æ•°æ®è´¨é‡å’Œå®Œæ•´æ€§
- æä¾›ä¼˜åŒ–å»ºè®®å’Œæ”¹è¿›æ–¹å‘
- å¯¼å‡ºå¤šç§æ ¼å¼çš„æŠ¥å‘Šæ–‡ä»¶

## ğŸ“Š è¾“å‡ºç»“æœ

### 1. ç»¼åˆæŠ¥å‘Š (`comprehensive_report.json`)
```json
{
  "project_info": {
    "drawing_file": "å›¾çº¸æ–‡ä»¶è·¯å¾„",
    "processing_date": "å¤„ç†æ—¥æœŸ",
    "system_version": "ç³»ç»Ÿç‰ˆæœ¬"
  },
  "recognition_summary": {
    "ocr_texts": "è¯†åˆ«æ–‡æœ¬æ•°é‡",
    "recognized_symbols": "è¯†åˆ«ç¬¦å·æ•°é‡",
    "dimensions": "è¯†åˆ«å°ºå¯¸æ•°é‡"
  },
  "quantity_summary": {
    "concrete_volume": "æ··å‡åœŸä½“ç§¯(mÂ³)",
    "formwork_area": "æ¨¡æ¿é¢ç§¯(mÂ²)",
    "rebar_weight": "é’¢ç­‹é‡é‡(kg)",
    "estimated_cost": "ä¼°ç®—é€ ä»·"
  }
}
```

### 2. å·¥ç¨‹é‡æ¸…å• (`quantity_list.json`)
```json
{
  "010101001": {
    "name": "ç°æµ‡æ··å‡åœŸæŸ±",
    "unit": "mÂ³",
    "quantity": 0.384,
    "components": [...]
  },
  "statistics": {
    "total_components": 3,
    "concrete_volume": 6.894,
    "formwork_area": 60.3,
    "rebar_weight": 539.1
  }
}
```

### 3. å®Œæ•´ç»“æœ (`complete_results.json`)
åŒ…å«æ‰€æœ‰å¤„ç†æ­¥éª¤çš„è¯¦ç»†æ•°æ®ï¼Œç”¨äºè°ƒè¯•å’Œåˆ†æã€‚

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. å»ºç­‘è®¾è®¡é™¢
- å¿«é€Ÿç”Ÿæˆå·¥ç¨‹é‡æ¸…å•
- è¾…åŠ©æ–¹æ¡ˆæ¯”é€‰å’Œä¼˜åŒ–
- æé«˜è®¾è®¡æ•ˆç‡å’Œå‡†ç¡®æ€§

### 2. æ–½å·¥ä¼ä¸š
- æŠ•æ ‡æŠ¥ä»·å·¥ç¨‹é‡è®¡ç®—
- æ–½å·¥å›¾é¢„ç®—ç¼–åˆ¶
- ææ–™é‡‡è´­è®¡åˆ’åˆ¶å®š

### 3. é€ ä»·å’¨è¯¢
- å·¥ç¨‹é‡å¤æ ¸å’Œå®¡æŸ¥
- é€ ä»·åˆ†æå’Œæ§åˆ¶
- æ ‡å‡†åŒ–è®¡ç®—æµç¨‹

### 4. æ•™è‚²åŸ¹è®­
- å·¥ç¨‹é‡è®¡ç®—æ•™å­¦
- è§„èŒƒæ ‡å‡†å­¦ä¹ 
- å®è·µæ¡ˆä¾‹åˆ†æ

## âš™ï¸ é…ç½®è¯´æ˜

### 1. æ¨¡å‹é…ç½®
```python
# YOLOv8æ¨¡å‹è·¯å¾„
MODEL_PATH = "app/services/models/best.pt"

# OCRå¼•æ“é…ç½®
OCR_CONFIG = {
    "use_angle_cls": True,
    "lang": "ch",
    "det_model_dir": None,
    "rec_model_dir": None
}
```

### 2. è®¡ç®—å‚æ•°
```python
# é’¢ç­‹ç”¨é‡ç³»æ•° (kg/mÂ³)
REBAR_RATIOS = {
    "column": 100,  # æŸ±
    "beam": 130,    # æ¢
    "slab": 70      # æ¿
}

# å¸‚åœºä»·æ ¼ (å…ƒ)
MARKET_PRICES = {
    "concrete": 350,  # å…ƒ/mÂ³
    "formwork": 45,   # å…ƒ/mÂ²
    "rebar": 4.2      # å…ƒ/kg
}
```

### 3. è¯†åˆ«é˜ˆå€¼
```python
# ç½®ä¿¡åº¦é˜ˆå€¼
CONFIDENCE_THRESHOLD = 0.5

# æœ€å°æ´å£é¢ç§¯ (mÂ²)
MIN_OPENING_AREA = 0.3

# å°ºå¯¸è¯†åˆ«ç²¾åº¦
DIMENSION_PRECISION = 1  # mm
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰æ„ä»¶ç±»å‹
```python
# æ‰©å±•æ„ä»¶ç¬¦å·åº“
custom_symbols = {
    "XKZ": AtlasSymbolData(
        symbol="XKZ",
        name="å‹é’¢æ··å‡åœŸæŸ±",
        category=ComponentSymbol.KZ,
        # ... å…¶ä»–é…ç½®
    )
}
```

### 2. è‡ªå®šä¹‰è®¡ç®—è§„åˆ™
```python
# æ·»åŠ æ–°çš„è®¡ç®—è§„åˆ™
def calculate_custom_component(component):
    # è‡ªå®šä¹‰è®¡ç®—é€»è¾‘
    return {
        "custom_rule": quantity,
        "unit": "mÂ³"
    }
```

### 3. æ‰¹é‡å¤„ç†
```python
# æ‰¹é‡å¤„ç†å¤šä¸ªå›¾çº¸
def batch_process(image_paths):
    system = IntelligentQuantitySystem()
    results = []
    
    for path in image_paths:
        result = system.process_architectural_drawing(path)
        results.append(result)
    
    return results
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: OCRè¯†åˆ«æ•ˆæœä¸ä½³æ€ä¹ˆåŠï¼Ÿ
**A**: 
- ç¡®ä¿å›¾çº¸æ¸…æ™°åº¦è¶³å¤Ÿé«˜ï¼ˆå»ºè®®300DPIä»¥ä¸Šï¼‰
- æ£€æŸ¥å›¾çº¸å¯¹æ¯”åº¦ï¼Œé¿å…è¿‡æš—æˆ–è¿‡äº®
- å°è¯•è°ƒæ•´å›¾çº¸æ–¹å‘ï¼Œç¡®ä¿æ–‡å­—æ°´å¹³
- å®‰è£…PaddleOCRä»¥è·å¾—æ›´å¥½çš„è¯†åˆ«æ•ˆæœ

### Q2: æ„ä»¶ç¬¦å·è¯†åˆ«ä¸å‡†ç¡®ï¼Ÿ
**A**:
- æ£€æŸ¥æ„ä»¶ç¬¦å·æ˜¯å¦ç¬¦åˆå›½æ ‡è§„èŒƒ
- ç¡®ä¿ç¬¦å·å­—ä½“æ¸…æ™°ï¼Œé¿å…æ‰‹å†™ä½“
- éªŒè¯ç¬¦å·ç¼–å·æ ¼å¼ï¼ˆå¦‚KZ1ã€KL2ç­‰ï¼‰
- å¯ä»¥æ‰‹åŠ¨è¡¥å……ç¼ºå¤±çš„æ„ä»¶ä¿¡æ¯

### Q3: å·¥ç¨‹é‡è®¡ç®—ç»“æœå¼‚å¸¸ï¼Ÿ
**A**:
- æ£€æŸ¥æ„ä»¶å°ºå¯¸æ˜¯å¦åˆç†
- éªŒè¯ææ–™ç­‰çº§å’Œè§„æ ¼
- ç¡®è®¤è®¡ç®—è§„åˆ™æ˜¯å¦é€‚ç”¨
- æŸ¥çœ‹æ‰£å‡è§„åˆ™æ˜¯å¦æ­£ç¡®åº”ç”¨

### Q4: ç³»ç»Ÿè¿è¡Œé€Ÿåº¦æ…¢ï¼Ÿ
**A**:
- ä¼˜åŒ–å›¾çº¸åˆ†è¾¨ç‡ï¼Œé¿å…è¿‡å¤§æ–‡ä»¶
- ä½¿ç”¨GPUåŠ é€Ÿï¼ˆå¦‚æœå¯ç”¨ï¼‰
- å…³é—­ä¸å¿…è¦çš„è¯†åˆ«åŠŸèƒ½
- è€ƒè™‘ä½¿ç”¨æ›´è½»é‡çš„æ¨¡å‹

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å›¾åƒé¢„å¤„ç†
```python
# å›¾åƒä¼˜åŒ–
def optimize_image(image_path):
    img = cv2.imread(image_path)
    # è°ƒæ•´å¤§å°
    img = cv2.resize(img, (1920, 1080))
    # å¢å¼ºå¯¹æ¯”åº¦
    img = cv2.convertScaleAbs(img, alpha=1.2, beta=10)
    return img
```

### 2. å¹¶è¡Œå¤„ç†
```python
# å¤šçº¿ç¨‹å¤„ç†
from concurrent.futures import ThreadPoolExecutor

def parallel_process(image_paths):
    with ThreadPoolExecutor(max_workers=4) as executor:
        futures = [executor.submit(process_image, path) 
                  for path in image_paths]
        results = [future.result() for future in futures]
    return results
```

### 3. ç¼“å­˜æœºåˆ¶
```python
# ç»“æœç¼“å­˜
import pickle

def cache_results(results, cache_path):
    with open(cache_path, 'wb') as f:
        pickle.dump(results, f)

def load_cached_results(cache_path):
    with open(cache_path, 'rb') as f:
        return pickle.load(f)
```

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-15)
- âœ… å®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘
- âœ… é›†æˆOCRã€å›¾é›†è¯†åˆ«ã€å·¥ç¨‹é‡è®¡ç®—
- âœ… æ”¯æŒGB 50500-2013è®¡ç®—è§„èŒƒ
- âœ… æä¾›å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- âœ… ç”Ÿæˆè¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

### è®¡åˆ’åŠŸèƒ½
- ğŸ”„ æ”¯æŒæ›´å¤šå›¾é›†æ ‡å‡†
- ğŸ”„ å¢åŠ 3Dæ¨¡å‹è¯†åˆ«
- ğŸ”„ é›†æˆBIMæ•°æ®æ¥å£
- ğŸ”„ æ”¯æŒäº‘ç«¯éƒ¨ç½²
- ğŸ”„ ç§»åŠ¨ç«¯åº”ç”¨å¼€å‘

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š
- ğŸ“§ é‚®ç®±: support@smart-qto.com
- ğŸŒ å®˜ç½‘: https://smart-qto.com
- ğŸ“± å¾®ä¿¡: SmartQTO2024

---

**æ™ºèƒ½å·¥ç¨‹é‡è®¡ç®—ç³»ç»Ÿ** - è®©å·¥ç¨‹é‡è®¡ç®—æ›´æ™ºèƒ½ã€æ›´å‡†ç¡®ã€æ›´é«˜æ•ˆï¼ 