# ğŸ—ºï¸ æ™ºèƒ½å·¥ç¨‹é‡åˆ†æç³»ç»Ÿ - å®Œæ•´è·¯ç”±æ˜ å°„è¡¨

> **ç³»ç»Ÿç‰ˆæœ¬**: v2.0 (é‡æ„å)  
> **ç”Ÿæˆæ—¶é—´**: 2024å¹´12æœˆ12æ—¥  
> **è·¯ç”±æ€»æ•°**: 83ä¸ªHTTPè·¯ç”± + 4ä¸ªWebSocketè·¯ç”±  

## ğŸ“Š è·¯ç”±ç»Ÿè®¡æ€»è§ˆ

| æ¨¡å—ç±»å‹ | è·¯ç”±æ•°é‡ | çŠ¶æ€ | æè¿° |
|---------|---------|------|------|
| ğŸ” è®¤è¯æ¨¡å— | 2 | âœ… | ç”¨æˆ·ç™»å½•æ³¨å†Œ |
| ğŸ‘¥ ç”¨æˆ·ç®¡ç† | 13 | âœ… | ç”¨æˆ·CRUDå’ŒçŠ¶æ€ç®¡ç† |
| ğŸ“„ å›¾çº¸ç®¡ç† | 20 | âœ… | å›¾çº¸ä¸Šä¼ å¤„ç†å’Œåˆ†æ |
| ğŸ§± æ„ä»¶ç®¡ç† | 5 | âœ… | æ„ä»¶è¯†åˆ«å’Œç®¡ç† |
| ğŸ‘ï¸ OCRè¯†åˆ« | 2 | âœ… | å›¾çº¸OCRå¤„ç† |
| ğŸ“‹ ä»»åŠ¡ç®¡ç† | 8 | âœ… | å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ |
| ğŸ“¤ æ•°æ®å¯¼å‡º | 6 | âœ… | å¤šæ ¼å¼æ•°æ®å¯¼å‡º |
| ğŸ¤– AIåˆ†æ | 19 | âœ… | AIåˆ†æå¼•æ“ |
| âš¡ WebSocket | 8 | âœ… | å®æ—¶é€šä¿¡ |
| ğŸ› ï¸ è°ƒè¯•å·¥å…· | 3 | âœ… | å¼€å‘è°ƒè¯• |

## ğŸ—ï¸ è·¯ç”±æ¶æ„å±‚çº§

```
/api/v1/                          # ä¸»APIå‰ç¼€
â”œâ”€â”€ auth/                         # ğŸ” è®¤è¯æ¨¡å—
â”œâ”€â”€ users/                        # ğŸ‘¥ ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ drawings/                     # ğŸ“„ å›¾çº¸ç®¡ç†
â”œâ”€â”€ components/                   # ğŸ§± æ„ä»¶ç®¡ç†
â”œâ”€â”€ ocr/                         # ğŸ‘ï¸ OCRè¯†åˆ«
â”œâ”€â”€ tasks/                       # ğŸ“‹ ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ export/                      # ğŸ“¤ æ•°æ®å¯¼å‡º
â”œâ”€â”€ ai/                          # ğŸ¤– AIåˆ†æ
â”œâ”€â”€ ws/                          # âš¡ WebSocketæœåŠ¡
â””â”€â”€ debug/                       # ğŸ› ï¸ è°ƒè¯•å·¥å…·

/ws/                             # å…¼å®¹æ€§WebSocketå‰ç¼€
â””â”€â”€ *                            # æ—§ç‰ˆWebSocketè·¯ç”±
```

## ğŸ“‹ è¯¦ç»†è·¯ç”±æ¸…å•

### ğŸ” è®¤è¯æ¨¡å— (`/api/v1/auth/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| POST | `/login` | ç”¨æˆ·ç™»å½• | å…¬å¼€ |
| POST | `/register` | ç”¨æˆ·æ³¨å†Œ | å…¬å¼€ |

### ğŸ‘¥ ç”¨æˆ·ç®¡ç† (`/api/v1/users/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/` | è·å–ç”¨æˆ·åˆ—è¡¨ | ç®¡ç†å‘˜ |
| POST | `/` | åˆ›å»ºæ–°ç”¨æˆ· | ç®¡ç†å‘˜ |
| GET | `/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | ç”¨æˆ· |
| PUT | `/me` | æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯ | ç”¨æˆ· |
| GET | `/me/stats` | è·å–å½“å‰ç”¨æˆ·ç»Ÿè®¡ | ç”¨æˆ· |
| POST | `/change-password` | ä¿®æ”¹å¯†ç  | ç”¨æˆ· |
| POST | `/reset-password` | é‡ç½®å¯†ç  | å…¬å¼€ |
| GET | `/{user_id}` | è·å–æŒ‡å®šç”¨æˆ· | ç®¡ç†å‘˜ |
| PUT | `/{user_id}` | æ›´æ–°æŒ‡å®šç”¨æˆ· | ç®¡ç†å‘˜ |
| DELETE | `/{user_id}` | åˆ é™¤æŒ‡å®šç”¨æˆ· | ç®¡ç†å‘˜ |
| POST | `/{user_id}/activate` | æ¿€æ´»ç”¨æˆ· | ç®¡ç†å‘˜ |
| POST | `/{user_id}/deactivate` | åœç”¨ç”¨æˆ· | ç®¡ç†å‘˜ |
| GET | `/{user_id}/stats` | è·å–ç”¨æˆ·ç»Ÿè®¡ | ç®¡ç†å‘˜ |

### ğŸ“„ å›¾çº¸ç®¡ç† (`/api/v1/drawings/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/` | è·å–å›¾çº¸åˆ—è¡¨ | ç”¨æˆ· |
| POST | `/upload` | ä¸Šä¼ å•ä¸ªå›¾çº¸ | ç”¨æˆ· |
| POST | `/batch/upload` | æ‰¹é‡ä¸Šä¼ å›¾çº¸ | ç”¨æˆ· |
| DELETE | `/batch` | æ‰¹é‡åˆ é™¤å›¾çº¸ | ç”¨æˆ· |
| GET | `/tasks/{task_id}` | è·å–ä¸Šä¼ ä»»åŠ¡çŠ¶æ€ | ç”¨æˆ· |
| GET | `/{drawing_id}` | è·å–å›¾çº¸è¯¦æƒ… | ç”¨æˆ· |
| DELETE | `/{drawing_id}` | åˆ é™¤æŒ‡å®šå›¾çº¸ | ç”¨æˆ· |
| GET | `/{drawing_id}/status` | è·å–å›¾çº¸å¤„ç†çŠ¶æ€ | ç”¨æˆ· |
| POST | `/{drawing_id}/process` | å¤„ç†å›¾çº¸ | ç”¨æˆ· |
| POST | `/{drawing_id}/ocr` | å›¾çº¸OCRè¯†åˆ« | ç”¨æˆ· |
| GET | `/{drawing_id}/ocr-results` | è·å–OCRç»“æœ | ç”¨æˆ· |
| POST | `/{drawing_id}/detect-components` | æ„ä»¶æ£€æµ‹ | ç”¨æˆ· |
| GET | `/{drawing_id}/components` | è·å–æ„ä»¶åˆ—è¡¨ | ç”¨æˆ· |
| GET | `/{drawing_id}/analysis-results` | è·å–åˆ†æç»“æœ | ç”¨æˆ· |
| GET | `/{drawing_id}/s3-content/{content_type}` | è·å–S3å†…å®¹ | ç”¨æˆ· |
| GET | `/{drawing_id}/export` | å¯¼å‡ºå›¾çº¸æ•°æ® | ç”¨æˆ· |
| GET | `/{drawing_id}/export/preview` | å¯¼å‡ºé¢„è§ˆ | ç”¨æˆ· |
| GET | `/{drawing_id}/export/excel` | å¯¼å‡ºExcel | ç”¨æˆ· |
| GET | `/{drawing_id}/export/json` | å¯¼å‡ºJSON | ç”¨æˆ· |
| GET | `/{drawing_id}/export/pdf-report` | å¯¼å‡ºPDFæŠ¥å‘Š | ç”¨æˆ· |

### ğŸ§± æ„ä»¶ç®¡ç† (`/api/v1/components/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/` | è·å–æ„ä»¶åˆ—è¡¨ | ç”¨æˆ· |
| GET | `/{component_id}` | è·å–æ„ä»¶è¯¦æƒ… | ç”¨æˆ· |
| POST | `/batch-update` | æ‰¹é‡æ›´æ–°æ„ä»¶ | ç”¨æˆ· |
| GET | `/templates` | è·å–æ„ä»¶æ¨¡æ¿ | ç”¨æˆ· |
| GET | `/statistics` | è·å–æ„ä»¶ç»Ÿè®¡ | ç”¨æˆ· |

### ğŸ‘ï¸ OCRè¯†åˆ« (`/api/v1/ocr/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| POST | `/process-drawing` | å¤„ç†å›¾çº¸OCR | ç”¨æˆ· |
| POST | `/process-results` | å¤„ç†OCRç»“æœ | ç”¨æˆ· |

### ğŸ“‹ ä»»åŠ¡ç®¡ç† (`/api/v1/tasks/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/tasks` | è·å–ä»»åŠ¡åˆ—è¡¨ | ç”¨æˆ· |
| POST | `/tasks/ocr` | åˆ›å»ºOCRä»»åŠ¡ | ç”¨æˆ· |
| POST | `/tasks/batch-ocr` | æ‰¹é‡OCRä»»åŠ¡ | ç”¨æˆ· |
| GET | `/tasks/stats` | è·å–ä»»åŠ¡ç»Ÿè®¡ | ç”¨æˆ· |
| GET | `/tasks/{task_id}/status` | è·å–ä»»åŠ¡çŠ¶æ€ | ç”¨æˆ· |
| GET | `/tasks/{task_id}/result` | è·å–ä»»åŠ¡ç»“æœ | ç”¨æˆ· |
| GET | `/tasks/{task_id}/history` | è·å–ä»»åŠ¡å†å² | ç”¨æˆ· |
| DELETE | `/tasks/{task_id}` | åˆ é™¤ä»»åŠ¡ | ç”¨æˆ· |

### ğŸ“¤ æ•°æ®å¯¼å‡º (`/api/v1/export/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/excel/{drawing_id}` | å¯¼å‡ºExcel | ç”¨æˆ· |
| GET | `/json/{drawing_id}` | å¯¼å‡ºJSON | ç”¨æˆ· |
| GET | `/csv/{drawing_id}` | å¯¼å‡ºCSV | ç”¨æˆ· |
| GET | `/pdf/{drawing_id}` | å¯¼å‡ºPDF | ç”¨æˆ· |
| POST | `/batch/{format}` | æ‰¹é‡å¯¼å‡º | ç”¨æˆ· |
| GET | `/templates` | è·å–å¯¼å‡ºæ¨¡æ¿ | ç”¨æˆ· |

### ğŸ¤– AIåˆ†ææ¨¡å— (`/api/v1/ai/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| POST | `/analyze-drawing/{drawing_id}` | åˆ†æå›¾çº¸ | ç”¨æˆ· |
| POST | `/chat-analysis` | èŠå¤©åˆ†æ | ç”¨æˆ· |
| GET | `/model-status` | è·å–æ¨¡å‹çŠ¶æ€ | ç”¨æˆ· |
| GET | `/supported-models` | æ”¯æŒçš„æ¨¡å‹ | ç”¨æˆ· |
| POST | `/upload-and-analyze` | ä¸Šä¼ å¹¶åˆ†æ | ç”¨æˆ· |
| POST | `/batch-analyze` | æ‰¹é‡åˆ†æ | ç”¨æˆ· |
| GET | `/analysis-history/{drawing_id}` | åˆ†æå†å² | ç”¨æˆ· |
| DELETE | `/analysis/{drawing_id}` | åˆ é™¤åˆ†æ | ç”¨æˆ· |

#### ğŸ¤– ChatGPTå­æ¨¡å— (`/api/v1/ai/chatgpt/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| POST | `/analyze-pdf` | PDFåˆ†æ | ç”¨æˆ· |
| GET | `/analysis-status/{task_id}` | åˆ†æçŠ¶æ€ | ç”¨æˆ· |
| DELETE | `/analysis/{task_id}` | åˆ é™¤åˆ†æ | ç”¨æˆ· |
| GET | `/download-excel/{task_id}` | ä¸‹è½½Excel | ç”¨æˆ· |
| GET | `/supported-models` | æ”¯æŒæ¨¡å‹ | ç”¨æˆ· |

#### ğŸ§ª AIæµ‹è¯•åœº (`/api/v1/ai/playground/`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| POST | `/chat` | èŠå¤©æµ‹è¯• | ç”¨æˆ· |
| GET | `/models` | å¯ç”¨æ¨¡å‹ | ç”¨æˆ· |
| GET | `/presets` | é¢„è®¾æ¨¡æ¿ | ç”¨æˆ· |
| POST | `/stream` | æµå¼å“åº” | ç”¨æˆ· |
| GET | `/usage` | ä½¿ç”¨ç»Ÿè®¡ | ç”¨æˆ· |
| POST | `/validate` | éªŒè¯é…ç½® | ç”¨æˆ· |

### âš¡ WebSocketæœåŠ¡ (`/api/v1/ws/`)

| åè®® | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| WS | `/task-status/{user_id}` | ä»»åŠ¡çŠ¶æ€æ¨é€ | ç”¨æˆ· |
| WS | `/drawing-progress/{drawing_id}` | å›¾çº¸è¿›åº¦æ¨é€ | ç”¨æˆ· |
| WS | `/ai-analysis/{session_id}` | AIåˆ†ææ¨é€ | ç”¨æˆ· |
| WS | `/realtime/{connection_id}` | å®æ—¶æ›´æ–° | ç”¨æˆ· |
| POST | `/status` | è¿æ¥çŠ¶æ€ | ç”¨æˆ· |
| POST | `/broadcast/{channel}` | å¹¿æ’­æ¶ˆæ¯ | ç®¡ç†å‘˜ |
| POST | `/push/task-update/{user_id}` | æ¨é€ä»»åŠ¡æ›´æ–° | ç³»ç»Ÿ |
| POST | `/push/drawing-progress/{drawing_id}` | æ¨é€å›¾çº¸è¿›åº¦ | ç³»ç»Ÿ |

### ğŸ› ï¸ è°ƒè¯•å·¥å…· (`/api/v1/debug/`) 

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/health` | å¥åº·æ£€æŸ¥ | å…¬å¼€ |
| GET | `/calculation-debug/{drawing_id}` | è®¡ç®—è°ƒè¯• | å¼€å‘è€… |
| POST | `/test-config` | æµ‹è¯•é…ç½® | å¼€å‘è€… |

## ğŸ”„ å…¼å®¹æ€§è·¯ç”± (`/ws/`)

ä¸ºäº†å‘åå…¼å®¹ï¼Œç³»ç»Ÿä¿ç•™äº†æ—§ç‰ˆWebSocketè·¯ç”±ï¼š

| åè®® | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| WS | `/realtime/{connection_id}` | å®æ—¶é€šä¿¡ | ğŸš§ å…¼å®¹ä¸­ |
| WS | `/drawing-upload/{user_id}` | å›¾çº¸ä¸Šä¼ æ¨é€ | ğŸš§ å…¼å®¹ä¸­ |
| WS | `/analysis-progress/{task_id}` | åˆ†æè¿›åº¦æ¨é€ | ğŸš§ å…¼å®¹ä¸­ |
| WS | `/system-notification/{user_id}` | ç³»ç»Ÿé€šçŸ¥ | ğŸš§ å…¼å®¹ä¸­ |

## ğŸ” ä¸­é—´ä»¶å’Œæƒé™éªŒè¯

### è®¤è¯ä¸­é—´ä»¶

- **JWTéªŒè¯**: æ‰€æœ‰éœ€è¦æƒé™çš„è·¯ç”±éƒ½éœ€è¦JWT token
- **ç”¨æˆ·éš”ç¦»**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **ç®¡ç†å‘˜ç‰¹æƒ**: ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰ç”¨æˆ·æ•°æ®

### CORSé…ç½®

```python
# å½“å‰é…ç½®
allow_origins = ["*"]          # ç”Ÿäº§ç¯å¢ƒéœ€è¦ä¿®æ”¹
allow_credentials = True
allow_methods = ["*"]
allow_headers = ["*"]
```

### WebSocketè®¤è¯

- **è¿æ¥è®¤è¯**: WebSocketè¿æ¥éœ€è¦JWTéªŒè¯
- **é¢‘ç‡é™åˆ¶**: é˜²æ­¢è¿æ¥æ»¥ç”¨
- **è‡ªåŠ¨æ–­å¼€**: æ— æ•ˆè¿æ¥è‡ªåŠ¨æ¸…ç†

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œå»ºè®®

### 1. è·¯ç”±å†²çªé—®é¢˜

**é—®é¢˜**: main.pyä¸­åŒæ—¶æ³¨å†Œäº† `/ws` å’Œ `/api/v1/ws` å‰ç¼€

**å»ºè®®**:
```python
# æ¨èé…ç½® - ç»Ÿä¸€å‰ç¼€
# ä¸»è¦WebSocketæœåŠ¡
app.include_router(api_router, prefix="/api/v1")

# å…¼å®¹æ€§æ”¯æŒï¼ˆå¯é€‰ï¼‰
app.include_router(legacy_websocket_router, prefix="/ws")
```

### 2. å®‰å…¨æ€§å»ºè®®

- [ ] **CORSé…ç½®**: ç”Ÿäº§ç¯å¢ƒéœ€è¦é™åˆ¶å…·ä½“åŸŸå
- [ ] **APIé™æµ**: æ·»åŠ è¯·æ±‚é¢‘ç‡é™åˆ¶
- [ ] **è¾“å…¥éªŒè¯**: åŠ å¼ºå‚æ•°éªŒè¯å’Œæ¸…ç†
- [ ] **æ—¥å¿—å®¡è®¡**: è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ

### 3. æ€§èƒ½ä¼˜åŒ–å»ºè®®

- [ ] **ç¼“å­˜ç­–ç•¥**: æ·»åŠ Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
- [ ] **æ•°æ®åº“ä¼˜åŒ–**: ä¸ºé«˜é¢‘æŸ¥è¯¢æ·»åŠ ç´¢å¼•
- [ ] **æ–‡ä»¶å¤„ç†**: å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ æ”¯æŒ
- [ ] **WebSocketé›†ç¾¤**: æ”¯æŒå¤šå®ä¾‹è´Ÿè½½å‡è¡¡

## ğŸ”§ ç»´æŠ¤è¯´æ˜

### æ·»åŠ æ–°è·¯ç”±

1. åœ¨å¯¹åº”çš„`endpoints/`æ¨¡å—ä¸­æ·»åŠ è·¯ç”±
2. åœ¨`api.py`ä¸­æ³¨å†Œè·¯ç”±
3. æ›´æ–°æœ¬æ–‡æ¡£
4. è¿è¡Œè·¯ç”±æ£€æŸ¥è„šæœ¬éªŒè¯

### è·¯ç”±éªŒè¯å·¥å…·

```bash
# è¿è¡Œè·¯ç”±æ˜ å°„æ£€æŸ¥
python check_routes.py

# æµ‹è¯•FastAPIå¯åŠ¨
python main.py
```

### æ–‡æ¡£æ›´æ–°

æ¯æ¬¡è·¯ç”±å˜æ›´åï¼Œè¯·æ›´æ–°ï¼š
- [x] æœ¬è·¯ç”±æ˜ å°„è¡¨
- [ ] APIæ–‡æ¡£ï¼ˆSwaggerï¼‰
- [ ] å‰ç«¯è·¯ç”±é…ç½®
- [ ] éƒ¨ç½²é…ç½®æ–‡ä»¶

---

**æ–‡æ¡£ç»´æŠ¤è€…**: ç³»ç»Ÿæ¶æ„å¸ˆ  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ12æ—¥  
**ä¸‹æ¬¡å®¡æŸ¥**: 2024å¹´12æœˆ26æ—¥ 