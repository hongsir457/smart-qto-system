# ğŸš€ æ™ºèƒ½å·¥ç¨‹é‡è®¡ç®—ç³»ç»Ÿ - æ–°æ¶æ„å¯åŠ¨æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- RedisæœåŠ¡å™¨
- Windows 10/11 (æµ‹è¯•ç¯å¢ƒ)

## ğŸ”§ å¿«é€Ÿå¯åŠ¨

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ (æ¨è)

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨Redis (å¦‚æœæ²¡æœ‰è¿è¡Œ)
# Windows: ä¸‹è½½å¹¶å¯åŠ¨ Redis for Windows
# æˆ–ä½¿ç”¨ Docker: docker run -d -p 6379:6379 redis

# 4. è¿è¡Œå¯åŠ¨è„šæœ¬ (è‡ªåŠ¨å®Œæˆæ‰€æœ‰åˆå§‹åŒ–)
python start_system.py
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ†æ­¥å¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨Redis
redis-server

# 3. åˆå§‹åŒ–æ•°æ®åº“ (å¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œ)
python -c "
from app.database import engine, Base
from app.models.user import User
from app.core.security import get_password_hash
from app.database import SessionLocal

# åˆ›å»ºè¡¨
Base.metadata.create_all(bind=engine)

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
db = SessionLocal()
if not db.query(User).filter(User.username == 'testuser').first():
    test_user = User(
        username='testuser',
        email='test@example.com',
        full_name='æµ‹è¯•ç”¨æˆ·',
        hashed_password=get_password_hash('testpass123'),
        is_active=True
    )
    db.add(test_user)
    db.commit()
    print('æµ‹è¯•ç”¨æˆ·åˆ›å»ºæˆåŠŸ')
db.close()
"

# 4. å¯åŠ¨Celery Worker (æ–°çª—å£)
celery -A app.core.celery_app worker --loglevel=info --pool=solo

# 5. å¯åŠ¨FastAPI (æ–°çª—å£)
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
# ç¡®ä¿ç³»ç»Ÿå·²å¯åŠ¨åè¿è¡Œ
python test_new_architecture.py
```

## ğŸ“Š æµ‹è¯•æµç¨‹

æ–°æ¶æ„æµ‹è¯•åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. **ç”¨æˆ·è®¤è¯** - æµ‹è¯•ç™»å½•åŠŸèƒ½
2. **S3æ–‡ä»¶ä¸Šä¼ ** - æµ‹è¯•äº‘å­˜å‚¨é›†æˆ
3. **Celeryä»»åŠ¡å¤„ç†** - æµ‹è¯•å¼‚æ­¥ä»»åŠ¡å¤„ç†
4. **å·¥ç¨‹é‡è®¡ç®—** - æµ‹è¯•AIè¯†åˆ«å’Œè®¡ç®—
5. **å¯¼å‡ºåŠŸèƒ½** - æµ‹è¯•Excelå¯¼å‡º
6. **æ•°æ®ä¸€è‡´æ€§** - éªŒè¯æ•°æ®å®Œæ•´æ€§

## ğŸ”„ å®Œæ•´æ•°æ®æµç¨‹

```
ğŸ“¤ æ–‡ä»¶ä¸Šä¼  â†’ S3äº‘å­˜å‚¨ â†’ æ•°æ®åº“è®°å½• â†’ Celeryä»»åŠ¡è§¦å‘
    â†“
ğŸ”„ æ–‡ä»¶æ ¼å¼è½¬æ¢ (PDFâ†’PNG, DWGâ†’å›¾åƒ/æ–‡æœ¬)
    â†“
ğŸ¤– æ™ºèƒ½è¯†åˆ« (PaddleOCR + å¤§æ¨¡å‹äºŒé˜¶æ®µåˆ†æ)
    â†“
ğŸ§® å·¥ç¨‹é‡è®¡ç®— (æ„ä»¶åˆ†ç±» + å°ºå¯¸æå– + å…¬å¼è®¡ç®—)
    â†“
ğŸ’¾ æ•°æ®å­˜å‚¨ (JSONç»“æ„åŒ–å­˜å‚¨)
    â†“
ğŸ“Š ç»“æœå¯¼å‡º (Excelå¤šå·¥ä½œè¡¨)
```

## ğŸŒ ç³»ç»ŸæœåŠ¡

å¯åŠ¨å®Œæˆåå¯ä»¥è®¿é—®ï¼š

- **FastAPIæ–‡æ¡£**: http://localhost:8000/docs
- **ä¸»é¡µ**: http://localhost:8000
- **APIåŸºç¡€è·¯å¾„**: http://localhost:8000/api/v1

## ğŸ‘¤ æµ‹è¯•è´¦æˆ·

- **ç”¨æˆ·å**: testuser
- **å¯†ç **: testpass123
- **é‚®ç®±**: test@example.com

## ğŸ“ ä¸»è¦æ¨¡å—

### æ ¸å¿ƒæœåŠ¡
- `s3_service.py` - S3äº‘å­˜å‚¨æœåŠ¡
- `file_processor.py` - æ–‡ä»¶å¤„ç†å™¨ (PDF/DWG/å›¾ç‰‡)
- `quantity_calculator.py` - å·¥ç¨‹é‡è®¡ç®—å™¨
- `export_service.py` - Excelå¯¼å‡ºæœåŠ¡

### APIæ¥å£
- `upload.py` - æ–‡ä»¶ä¸Šä¼ API (æ”¯æŒS3)
- `export.py` - å¯¼å‡ºåŠŸèƒ½API
- `drawing_tasks.py` - Celeryå¼‚æ­¥ä»»åŠ¡

### æ•°æ®æ¨¡å‹
- æ–°å¢å­—æ®µï¼š`s3_key`, `s3_url`, `s3_bucket`
- ç»“æœå­—æ®µï¼š`quantity_results`, `recognition_results`

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.envæ–‡ä»¶)
```env
# AWS S3é…ç½® (æµ‹è¯•ç¯å¢ƒä½¿ç”¨é»˜è®¤å€¼)
AWS_ACCESS_KEY_ID=test_access_key
AWS_SECRET_ACCESS_KEY=test_secret_key
AWS_REGION=us-east-1
S3_BUCKET_NAME=smart-qto-bucket

# Redisé…ç½®
REDIS_URL=redis://localhost:6379/1

# OpenAIé…ç½® (å¯é€‰)
OPENAI_API_KEY=your_openai_key
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Redisè¿æ¥å¤±è´¥
```bash
# Windowså®‰è£…Redis
# 1. ä¸‹è½½ Redis for Windows
# 2. æˆ–ä½¿ç”¨ Docker: docker run -d -p 6379:6379 redis
```

### Celeryå¯åŠ¨å¤±è´¥
```bash
# Windowsæ¨èä½¿ç”¨soloæ± 
celery -A app.core.celery_app worker --pool=solo --loglevel=info
```

### S3æœåŠ¡åˆå§‹åŒ–å¤±è´¥
```bash
# æµ‹è¯•ç¯å¢ƒä½¿ç”¨æ¨¡æ‹ŸS3ï¼Œç¡®ä¿é…ç½®æ­£ç¡®
# ç”Ÿäº§ç¯å¢ƒéœ€è¦çœŸå®çš„AWSå‡­è¯
```

## âœ… å¯åŠ¨æˆåŠŸæ ‡å¿—

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼š

```
ğŸ‰ ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼
ğŸ“Š FastAPIæ–‡æ¡£: http://localhost:8000/docs
ğŸ” Redisè¿æ¥: localhost:6379
ğŸ‘¤ æµ‹è¯•ç”¨æˆ·: testuser / testpass123
ğŸ’¡ ç°åœ¨å¯ä»¥è¿è¡Œæµ‹è¯•: python test_new_architecture.py
```

## ğŸ§ª è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
python test_new_architecture.py
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸš€ æ™ºèƒ½å·¥ç¨‹é‡è®¡ç®—ç³»ç»Ÿ - æ–°æ¶æ„æµ‹è¯•
æµ‹è¯•æ•°æ®æµç¨‹ï¼šæ–‡ä»¶ä¸Šä¼  â†’ S3å­˜å‚¨ â†’ Celeryå¤„ç† â†’ å·¥ç¨‹é‡è®¡ç®— â†’ å¯¼å‡º
âœ… ç”¨æˆ·è®¤è¯æˆåŠŸ
âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
âœ… Celeryä»»åŠ¡å¤„ç†å®Œæˆ
âœ… å¯¼å‡ºé¢„è§ˆæˆåŠŸ
âœ… Excelå¯¼å‡ºæˆåŠŸ
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ–°æ¶æ„è¿è¡Œæ­£å¸¸
```

## ğŸ“š æ¶æ„ä¼˜åŠ¿

1. **ç»Ÿä¸€Celeryæ¶æ„** - ç§»é™¤FastAPI BackgroundTasksï¼Œç»Ÿä¸€å¼‚æ­¥å¤„ç†
2. **S3äº‘å­˜å‚¨é›†æˆ** - å¯æ‰©å±•çš„æ–‡ä»¶å­˜å‚¨è§£å†³æ–¹æ¡ˆ
3. **æ™ºèƒ½å¤„ç†æµæ°´çº¿** - å¤šæ ¼å¼æ”¯æŒ + AIå¤šæ¨¡æ€è¯†åˆ«
4. **ä¸“ä¸šå·¥ç¨‹é‡è®¡ç®—** - ç¬¦åˆè§„èŒƒçš„Excelè¡¨æ ¼å¯¼å‡º
5. **å®Œå–„çš„æµ‹è¯•è¦†ç›–** - ç«¯åˆ°ç«¯æµç¨‹éªŒè¯

---

ğŸ‰ **å‡†å¤‡å¥½ä½“éªŒæ–°æ¶æ„äº†å—ï¼Ÿè¿è¡Œ `python start_system.py` å¼€å§‹å§ï¼**